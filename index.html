
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kai-Jen Tsai | Learning Specialist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./index.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.9.0",
    "path": "https://esm.sh/path@^0.12.7",
    "vite": "https://esm.sh/vite@^7.0.4",
    "url": "https://esm.sh/url@^0.11.4"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V4W3PXVF6Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-V4W3PXVF6Y');
</script>
    <div class="container">
        <header class="header anim-target" data-anim-delay="0.1">
            <nav class="header-nav header-nav-left">
                <a id="nav-home-main">HOME</a>
                <a id="nav-works">WORKS</a>
                <a id="nav-timeline">TIMELINE</a>
            </nav>
            <div class="logo" id="nav-home-logo">
                <a>
                    <span class="logo-char">K</span><span class="logo-char">a</span><span class="logo-char">i</span><span class="logo-char">X</span>
                </a>
            </div>
            <nav class="header-nav header-nav-right">
                <a id="nav-faq">FAQ</a>
                <a id="nav-contact">CONTACT</a>
                <a id="settings-btn">SETTINGS</a>
            </nav>
        </header>

        <main id="home-page">
            <div class="heading-row anim-target" data-anim-delay="0.3">
                 <h1 class="main-heading">
                    Kai-Jen Tsai
                    <span class="sub-heading">Learning Specialist<br>AI/VR Evangelist</span>
                </h1>
            </div>

            <div class="social-icons-main anim-target" data-anim-delay="0.4">
                <nav class="social-nav">
                    <a href="https://www.linkedin.com/in/kai-jen-tsai-99867857/" target="_blank" title="LinkedIn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                    </a>
                    <a href="https://youtube.com/@music_jojo?si=aIBmAHJ4-ACNSkAd" target="_blank" title="YouTube">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2A29 29 0 0 0 23 11.75a29 29 0 0 0-.46-5.33z"></path><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon></svg>
                    </a>
                </nav>
            </div>

            <div class="main-content-wrapper">
                <div class="left-column anim-target" data-anim-delay="0.5">
                    <div class="info-block">
                        <h3>BIOGRAPHY</h3>
                        <p>Over 12 years of experience as a Learning Specialist, collaborating with business units to tackle complex challenges in training and talent development.</p>
                    </div>
                    <div class="info-block">
                        <h3>SPECIALITY</h3>
                        <p class="instruction-text">Click a specialty to ask the AI about it.</p>
                        <div class="speciality-buttons">
                            <button class="speciality-btn" title="Click to ask about this specialty">Learning Experience Designer / ID</button>
                            <button class="speciality-btn" title="Click to ask about this specialty">Learning Consultant / Solutions Architect</button>
                            <button class="speciality-btn" title="Click to ask about this specialty">Learning Programme Manager</button>
                            <button class="speciality-btn" title="Click to ask about this specialty">Creative Director / Producer</button>
                            <button class="speciality-btn" title="Click to ask about this specialty">Learning Technologist / Multimedia Designer</button>
                            <button class="speciality-btn" title="Click to ask about this specialty">Trust and Safety Specialist</button>
                        </div>
                    </div>
                </div>

                <div class="center-column anim-target" data-anim-delay="0.6">
                    <div class="avatar-placeholder" id="logo-placeholder" title="Click to speak">
                        <div class="avatar-content">
                            <span class="avatar-text"></span>
                            <div class="wave-visualizer">
                                <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div id="transcript-box" class="transcript-box w-full h-28 mt-6 p-4 border border-gray-200 rounded-lg overflow-y-auto text-left shadow-inner">
                    </div>
                    <form id="chat-form-home" class="chat-input-form">
                        <input type="text" id="chat-input-home" placeholder="Type your message..." autocomplete="off">
                        <button type="submit" title="Send">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                        </button>
                    </form>
                </div>

                <div class="right-column anim-target" data-anim-delay="0.7">
                    <div class="metric-block">
                        <h3>Years of Experience</h3>
                        <p class="metric-number">12<sup>+</sup></p>
                    </div>
                    <div class="metric-block">
                        <h3>LearnX - Top of Mind</h3>
                        <p class="instruction-text">Click the term below to learn more.</p>
                        <p id="cycling-term" class="metric-number" title="Click to learn more about this term">Shared Reality</p>
                    </div>
                    <div class="metric-block">
                        <h3>Projects Done</h3>
                        <p class="metric-number">600<sup>+</sup></p>
                    </div>
                    <div class="metric-block">
                        <h3>Reach</h3>
                        <p class="metric-number">1 Mil<sup>+</sup></p>
                    </div>
                </div>
            </div>
        </main>

        <main id="works-page" class="hidden">
            <div class="heading-row anim-target">
                <h1 class="main-heading">Project Highlights</h1>
            </div>
            <div class="filter-buttons anim-target">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="Animation">Animation</button>
                <button class="filter-btn" data-filter="AR">AR</button>
                <button class="filter-btn" data-filter="EHS">EHS</button>
                <button class="filter-btn" data-filter="eLearning">eLearning</button>
                <button class="filter-btn" data-filter="Gamification">Gamification</button>
                <button class="filter-btn" data-filter="VR">VR</button>
            </div>
            <div class="carousel-wrapper anim-target">
                <div class="carousel-container">
                    <div class="carousel-track" id="carousel-track">
                        </div>
                </div>
                <div class="nav-arrow left" id="arrow-left">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </div>
                <div class="nav-arrow right" id="arrow-right">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </div>
            </div>
        </main>

        <main id="timeline-page" class="hidden">
            <div class="heading-row anim-target">
                <h1 class="main-heading">Professional Journey</h1>
            </div>
             <div class="timeline-headings">
                <h3 class="timeline-category-heading">Consulting / Contract</h3>
                <h3 class="timeline-category-heading">Full-Time Career</h3>
            </div>
            <div class="timeline-container">
                <div class="timeline-axis"></div>
                <!-- Primark (Full-Time) -->
                <div class="timeline-item right">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/MTG4dLz9/primark.png" alt="Primark Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>Primark</h4>
                                    <span class="timeline-date">(Current)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Learning Experience Designer</h5>
                                    <p>Designs and develops engaging learning programs and performance support tools for retail and corporate teams, focusing on improving key business metrics and enhancing employee skills.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
        
                <!-- Active Fence (Full-Time) -->
                <div class="timeline-item right">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/htFkcM0G/af.png" alt="Active Fence Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>Active Fence</h4>
                                    <span class="timeline-date">(May 2024 – Oct 2024)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                             <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Rapid Response Analyst</h5>
                                    <p>On the frontline of battling online misinformation, conducting OSINT investigations and developing Trust & Safety strategies to protect online platforms from malicious actors.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>

                 <!-- Meta (Full-Time) -->
                <div class="timeline-item right">
                    <div class="timeline-content">
                         <details>
                            <summary>
                                <img src="https://i.postimg.cc/6QcgVKx7/meta.png" alt="Meta Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>Meta</h4>
                                    <span class="timeline-date">(2022 - 2023)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Learning Consultant / Program Manager</h5>
                                    <p>Led global vendor education programs supporting over 100,000 people. Consulted with director-level executives to design training that reduced time-to-competence by 80%.</p>
                                    <button class="related-projects-btn" data-filter="meta-vr">View Related Projects</button>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>

                <!-- US Forestry Service (Contract) -->
                <div class="timeline-item left">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://upload.wikimedia.org/wikipedia/commons/e/e8/US_Forest_Service_logo.png" alt="US Forestry Service Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>US Forestry Service</h4>
                                    <span class="timeline-date">(Contract)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Instructional Designer</h5>
                                    <p>Designed and developed an innovative K-12 educational program using gamification to teach students about environmental conservation, forestry management, and the role of the Forest Service.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>

                <!-- UNICEF (Contract) -->
                 <div class="timeline-item left">
                    <div class="timeline-content">
                         <details>
                            <summary>
                                <img src="https://i.postimg.cc/P5gLpLqR/unicef.png" alt="UNICEF Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>UNICEF</h4>
                                    <span class="timeline-date">(Contract)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>eLearning Consultant</h5>
                                    <p>Created accessible eLearning modules on child protection policies and emergency response protocols, translated into multiple languages for deployment to UNICEF field staff worldwide.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
        
                <!-- Cognito Solution (Consulting) -->
                <div class="timeline-item left">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/h4mvzrXV/logo-transparent.png" alt="Cognito Solution Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>Cognito Solution</h4>
                                    <span class="timeline-date">(2020 - Present)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Founder / L&D Consultant</h5>
                                    <p>Founded Cognito Solution, a human-centric design consultancy. Operates as a UN Preferred Independent Contractor, creating innovative learning solutions for global clients.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>

                 <!-- UNITAR (Contract) -->
                <div class="timeline-item left">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/d0wgT1pP/un.png" alt="UNITAR Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>UNITAR</h4>
                                    <span class="timeline-date">(Contract)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>L&D Consultant</h5>
                                    <p>As a consultant for the United Nations Institute for Training and Research, Kai-Jen developed specialized curricula for global peacekeeping and diplomacy programs, leveraging micro-learning and simulation.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
        
                <!-- IQbusiness (Full-Time) -->
                <div class="timeline-item right">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/x1KWCHs3/iq.png" alt="IQbusiness Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>IQbusiness</h4>
                                    <span class="timeline-date">(2016 - 2019)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Training Manager / Senior Consultant</h5>
                                    <p>Built and led the VR development team, growing it from 3 to 22 members. Salvaged over 30 at-risk projects and delivered innovative VR training solutions for top-tier clients.</p>
                                     <button class="related-projects-btn" data-filter="iq-vr">View Related Projects</button>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
        
                <!-- ATAF (Full-Time) -->
                <div class="timeline-item right">
                    <div class="timeline-content">
                        <details>
                            <summary>
                                <img src="https://i.postimg.cc/VL0xx2nT/ataf.png" alt="ATAF Logo" class="timeline-logo">
                                <div class="summary-text">
                                    <h4>ATAF</h4>
                                    <span class="timeline-date">(2013 - 2015)</span>
                                </div>
                                <span class="accordion-icon"></span>
                            </summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <h5>Program Manager / Capacity Building</h5>
                                    <p>Established a continental tax academy for the African Tax Administration Forum, enhancing tax administration capabilities across Africa and exceeding program goals by 200%.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </main>
        
        <main id="faq-page" class="hidden">
            <div class="heading-row anim-target">
                <h1 class="main-heading">Frequently Asked Questions</h1>
            </div>
            <div class="faq-wrapper-grid anim-target">
                 <div class="faq-accordion-card">
                    <div id="faq-section">
                        <details>
                            <summary>Could you walk me through Kai's professional journey?<span class="accordion-icon"></span></summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <p>Of course. Kai's journey began with establishing a continental tax academy at ATAF, building foundational program management skills. At IQbusiness, he became a 'disaster manager' and VR pioneer, building the first VR dev team. Founding Cognito Solution allowed him to operate as a UN-preferred consultant. At Meta, he scaled global training programs for over 100,000 people, and at Active Fence, he delved into Trust & Safety. Currently, at Primark, he's designing learning experiences for a major retail workforce, blending all his past expertise.</p>
                                </div>
                            </div>
                        </details>
                        <details>
                            <summary>How does Kai adapt his strategies for such diverse industries?<span class="accordion-icon"></span></summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <p>Kai's core strategy is adaptability rooted in human-centric design. For every industry, he starts with a thorough Learning Needs Analysis (LNA) to understand the unique culture, challenges, and business goals. Whether it's compliance in banking, safety in mining, or policy in tech, he tailors the learning solution—from VR simulations to micro-learning—to align directly with the specific performance metrics that matter most to that sector, ensuring relevance and impact.</p>
                                </div>
                            </div>
                        </details>
                        <details>
                            <summary>Can you give an example of Kai's 'disaster manager' approach?<span class="accordion-icon"></span></summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <p>Certainly. At IQbusiness, Kai salvaged over 30 at-risk projects. His approach is methodical: First, he conducts a rapid audit to diagnose the core issues—be it scope creep, stakeholder misalignment, or resource gaps. He then re-engages all key stakeholders to establish a single source of truth and reset expectations. Using an Agile framework, he creates a clear, actionable roadmap with tight feedback loops, transforming chaos into a structured plan that drives the project to a successful completion.</p>
                                </div>
                            </div>
                        </details>
                        <details>
                            <summary>How has Kai used AI to create impactful learning?<span class="accordion-icon"></span></summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <p>A great example is his work at Primark. Instead of traditional role-playing, Kai leverages AI to create practice bots that simulate challenging customer interactions for retail staff. These bots provide a safe space for employees to practice their skills, offering instant, confidential feedback on their responses. This AI-driven approach significantly scales practice opportunities and reduces the 'time to competence' for new hires.</p>
                                </div>
                            </div>
                        </details>
                        <details>
                            <summary>What tools does Kai typically use for development?<span class="accordion-icon"></span></summary>
                            <div class="details-content">
                                <div class="details-content-wrapper">
                                    <p>Kai is proficient with a wide array of industry-standard tools. For authoring, he uses the Articulate 360 Suite, Captivate, and Elucidat. For creative and video work, he relies on the Adobe Creative Cloud (Premiere, After Effects) and Vyond. For VR and AR development, his go-to is Unity. He's also experienced with various Learning Management Systems (LMS) like Cornerstone and SAP LMS.</p>
                                </div>
                            </div>
                        </details>
                    </div>
                 </div>
                 <div class="faq-chat-card">
                     <div class="avatar-placeholder" id="logo-placeholder-faq" title="Click to speak">
                        <div class="avatar-content">
                            <span class="avatar-text"></span>
                            <div class="wave-visualizer">
                                <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
                            </div>
                        </div>
                     </div>
                    <div id="transcript-box-faq" class="transcript-box w-full h-28 mt-6 p-4 border border-gray-200 rounded-lg overflow-y-auto text-left shadow-inner">
                    </div>
                    <form id="chat-form-faq" class="chat-input-form">
                        <input type="text" id="chat-input-faq" placeholder="Ask me anything..." autocomplete="off">
                        <button type="submit" title="Send">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                        </button>
                    </form>
                 </div>
            </div>
        </main>


        <main id="contact-page" class="hidden">
            <div class="heading-row anim-target">
                <h1 class="main-heading">Get In Touch</h1>
            </div>
            <div class="contact-wrapper anim-target">
                <div class="contact-card">
                    <h4 class="contact-card-heading">Contact Details</h4>
                    <div class="info-block contact-details">
                        <p><strong>Email:</strong> <a href="mailto:kai@cognitosolution.com">kai@cognitosolution.com</a></p>
                        <p><strong>Phone:</strong> +353 87 459 0352</p>
                        <p><strong>Location:</strong> Dublin, Ireland</p>
                    </div>
                </div>
            </div>
        </main>
        
        <main id="knowledge-base-page" class="hidden">
            <div class="heading-row anim-target">
                <h1 class="main-heading">Knowledge Base</h1>
            </div>
            <div class="knowledge-wrapper">
                 <div class="knowledge-grid">
                    <div class="knowledge-section full-span">
                        <h3>Profile Summary</h3>
                        <p>A highly experienced Learning & Development Specialist, Program Manager, and Innovator with over 12 years of expertise in creating human-centric solutions. Passionate about leveraging advanced technologies like VR and AI to drive measurable organizational impact, consistently reducing "time to competence" by up to 80%.</p>
                    </div>

                    <div class="knowledge-section">
                        <h3>Core Competencies</h3>
                        <h4>L&D Strategy</h4>
                        <ul>
                            <li>Human-Centric Design</li>
                            <li>Kirkpatrick & Bloom's Models</li>
                            <li>Learning Needs Analysis (LNA/TNA)</li>
                            <li>Performance Consulting</li>
                        </ul>
                        <h4>Instructional Design</h4>
                        <ul>
                            <li>eLearning & ILT Development</li>
                            <li>Blended & Micro-Learning</li>
                            <li>Storytelling & Gamification</li>
                            <li>Creative Direction & Production</li>
                        </ul>
                        <h4>Technology & Innovation</h4>
                        <ul>
                            <li>AI/VR Evangelist</li>
                            <li>Immersive Learning (AR/VR)</li>
                            <li>AI Practice Bots & Integration</li>
                            <li>Spatial Computing</li>
                        </ul>
                         <h4>Management & Leadership</h4>
                        <ul>
                            <li>Agile, Kanban & Scrum Methodologies</li>
                            <li>Stakeholder & Vendor Management</li>
                            <li>Team Leadership & Mentorship</li>
                            <li>Certified OKR Coach</li>
                        </ul>
                    </div>

                    <div class="knowledge-section">
                        <h3>Professional Experience</h3>
                        <h4>Active Fence (May 2024 – Oct 2024)</h4>
                        <ul>
                            <li>Rapid Response Analyst, directly battling misinformation.</li>
                            <li>Conducted investigations using OSINT (Open-Source Intelligence) tools.</li>
                            <li>Created Trust & Safety strategies to identify bad actors.</li>
                            <li>Analyzed fraud, misinformation strategies, and behavioral patterns to report suspicious accounts.</li>
                        </ul>
                        <h4>Primark (Current)</h4>
                        <ul><li>Learning Experience Designer</li></ul>
                        <h4>Meta (2022-2023)</h4>
                        <ul><li>Learning Consultant / Training Program Manager</li></ul>
                        <h4>Cognito Solution (2020-Present)</h4>
                        <ul>
                            <li>Founder / Freelance L&D Consultant</li>
                            <li>Consultant for UN / UNITAR</li>
                        </ul>
                        <h4>IQbusiness (2016-2019)</h4>
                        <ul><li>Training Manager / Senior Consultant</li></ul>
                        <h4>ATAF (2013-2015)</h4>
                        <ul><li>Program Manager / Capacity Building Officer</li></ul>
                    </div>

                    <div class="knowledge-section">
                        <h3>Key Achievements & Impact</h3>
                        <ul>
                            <li>At <strong>Meta</strong>, reduced time-to-competence by 80% for AI & vendor teams.</li>
                            <li>At <strong>Primark</strong>, improved performance metrics by 50% through targeted skill programs.</li>
                            <li>At <strong>IQbusiness</strong>, salvaged 30+ "at-risk" projects and built the VR dev team from 3 to 22 members.</li>
                             <li>At <strong>ATAF</strong>, created a continental tax academy, boosting program goals by 200%.</li>
                            <li>Published 14+ VR experiences, including the award-winning "Nelson Mandela VR".</li>
                            <li>Founded <strong>Cognito Solution</strong>, now a UN Preferred Independent Contractor.</li>
                        </ul>
                    </div>

                    <div class="knowledge-section">
                        <h3>Toolset</h3>
                        <h4>Authoring</h4>
                        <ul><li>Articulate 360 Suite, Captivate, Camtasia, Elucidat</li></ul>
                        <h4>Creative</h4>
                        <ul><li>Adobe Creative Cloud (Premiere, AE, PS), Vyond</li></ul>
                        <h4>LMS</h4>
                        <ul><li>Cornerstone, Blackboard, SAP LMS, Moodle, Canvas</li></ul>
                        <h4>VR/AR</h4>
                        <ul><li>Unity, Oculus Platform</li></ul>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer-logos anim-target" data-anim-delay="1.1">
             <h4 class="footer-instruction">Click a logo to learn more about Kai's experience</h4>
             <ul>
                 <li><button class="company-logo-btn" data-company="Primark" title="Learn about Kai's work at Primark"><img src="https://i.postimg.cc/MTG4dLz9/primark.png" alt="Primark Logo"></button></li>
                 <li><button class="company-logo-btn" data-company="Active Fence" title="Learn about Kai's work at Active Fence"><img src="https://i.postimg.cc/htFkcM0G/af.png" alt="Active Fence Logo"></button></li>
                 <li><button class="company-logo-btn" data-company="Meta" title="Learn about Kai's work at Meta"><img src="https://i.postimg.cc/6QcgVKx7/meta.png" alt="Meta Logo"></button></li>
                 <li><button class="company-logo-btn" data-company="UNITAR" title="Learn about Kai's work at UNITAR"><img src="https://i.postimg.cc/d0wgT1pP/un.png" alt="UNITAR Logo"></button></li>
                 <li><button class="company-logo-btn" data-company="IQbusiness" title="Learn about Kai's work at IQbusiness"><img src="https://i.postimg.cc/x1KWCHs3/iq.png" alt="IQbusiness Logo"></button></li>
                 <li><button class="company-logo-btn" data-company="ATAF" title="Learn about Kai's work at ATAF"><img src="https://i.postimg.cc/VL0xx2nT/ataf.png" alt="ATAF Logo"></button></li>
             </ul>
        </footer>
    </div>

    <!-- Video Modal -->
    <div id="video-modal" class="modal-container hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="relative bg-black rounded-lg" style="width: 800px; max-width: 90vw;">
            <button id="close-video-btn" class="absolute -top-3 -right-3 bg-white rounded-full h-8 w-8 flex items-center justify-center text-black text-xl font-bold z-10">&times;</button>
            <div style="aspect-ratio: 800 / 600;">
                <iframe id="video-iframe" src="" class="w-full h-full" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>


    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-container hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <p class="text-xl font-bold text-gray-800">Settings</p>
                <button id="close-settings-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
             <div class="mt-4">
                <label for="local-api-key-input" class="block text-sm font-medium text-gray-700 mb-1">Local Gemini API Key</label>
                <input type="password" id="local-api-key-input" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md" placeholder="Enter key for local testing...">
                <p class="text-xs text-gray-500 mt-2">For local development only. This key is stored in your browser's local storage and is not sent to any server.</p>
            </div>
            <div class="mt-4">
                <label for="audio-input-select" class="block text-sm font-medium text-gray-700 mb-1">Audio Input Device</label>
                <select id="audio-input-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option>Default</option>
                </select>
                <p id="mic-permission-status" class="text-xs text-gray-500 mt-2"></p>
            </div>
            <div class="mt-4">
                <label for="voice-select" class="block text-sm font-medium text-gray-700 mb-1">AI Voice</label>
                <select id="voice-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option>Default</option>
                </select>
            </div>
            <div class="mt-4">
                <label for="activity-log" class="block text-sm font-medium text-gray-700 mb-1">Activity Log</label>
                <div id="activity-log" class="mt-1 block w-full h-24 p-2 text-xs bg-gray-100 border border-gray-300 rounded-md overflow-y-auto"></div>
            </div>
             <div class="mt-6 flex justify-between items-center">
                 <button id="help-btn" class="text-sm text-blue-600 hover:underline">Help</button>
                 <div class="space-x-4">
                     <button id="knowledge-base-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm hover:bg-gray-300">
                         Knowledge Base
                     </button>
                     <button id="save-settings-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                         Save & Close
                     </button>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="help-modal" class="modal-container hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <p class="text-xl font-bold text-gray-800">Help & Troubleshooting</p>
                <button id="close-help-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="mt-4 text-sm space-y-4">
                <div>
                    <h4 class="font-bold">AI Assistant Help</h4>
                    <p>The AI assistant requires a connection to Google's AI services to function. For production, this is pre-configured. For local testing, you can add your own Gemini API key in the Settings panel.</p>
                </div>
                <div>
                    <h4 class="font-bold">Microphone or Voice Issues</h4>
                    <p>If the AI cannot hear you or you cannot hear the AI:</p>
                     <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Ensure you have granted microphone permissions to this site in your browser.</li>
                        <li>Check that your microphone is selected as the "Audio Input Device" in the settings.</li>
                        <li>Try a different AI voice from the dropdown menu. Some browser voices may be more reliable than others.</li>
                    </ul>
                </div>
                 <div>
                    <h4 class="font-bold">Text Input</h4>
                    <p>You can type your questions into the input box below the AI avatar and press Enter or click the send button to interact with the assistant.</p>
                </div>
            </div>
        </div>
    </div>


    <!-- Term Description Modal -->
    <div id="term-modal" class="modal-container hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <p id="term-modal-title" class="text-xl font-bold text-gray-800"></p>
                <button id="close-term-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="term-modal-content" class="mt-4 text-sm"></div>
            <div class="mt-4 pt-4 border-t">
                <button id="term-to-works-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm hover:bg-gray-300 w-full">
                    Check out where I applied this in my works
                </button>
            </div>
        </div>
    </div>
    
    <!-- Company Experience Modal -->
    <div id="company-modal" class="modal-container hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3 border-b">
                <p id="company-modal-title" class="text-xl font-bold text-gray-800"></p>
                <button id="close-company-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="company-modal-content" class="mt-4 text-sm"></div>
            <div id="company-modal-footer" class="mt-4 pt-4 border-t">
                <button id="company-to-works-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm hover:bg-gray-300 w-full">
                    See Related Works
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        document.addEventListener('DOMContentLoaded', () => {

            // --- App Controller ---
            const App = {
                // --- State ---
                isFirstInteraction: true,
                chatHistory: [],
                recognition: null,
                micPermissionState: 'prompt', // 'prompt', 'granted', or 'denied'
                allProjects: [],
                carousel: {
                    animationFrame: null,
                    isPaused: false,
                    speed: 0.5,
                },
                
                // --- Elements ---
                pages: document.querySelectorAll('main'),
                nav: {
                    home: [document.getElementById('nav-home-main'), document.getElementById('nav-home-logo')],
                    works: document.getElementById('nav-works'),
                    timeline: document.getElementById('nav-timeline'),
                    faq: document.getElementById('nav-faq'),
                    contact: document.getElementById('nav-contact'),
                },
                settings: {
                    modal: document.getElementById('settings-modal'),
                    btn: document.getElementById('settings-btn'),
                    closeBtn: document.getElementById('close-settings-btn'),
                    saveBtn: document.getElementById('save-settings-btn'),
                    audioSelect: document.getElementById('audio-input-select'),
                    voiceSelect: document.getElementById('voice-select'),
                    micStatus: document.getElementById('mic-permission-status'),
                    knowledgeBaseBtn: document.getElementById('knowledge-base-btn'),
                    activityLog: document.getElementById('activity-log'),
                    helpBtn: document.getElementById('help-btn'),
                    helpModal: document.getElementById('help-modal'),
                    localApiKeyInput: document.getElementById('local-api-key-input'),
                },
                videoModal: {
                    container: document.getElementById('video-modal'),
                    closeBtn: document.getElementById('close-video-btn'),
                    iframe: document.getElementById('video-iframe'),
                },
                termModal: {
                    container: document.getElementById('term-modal'),
                    title: document.getElementById('term-modal-title'),
                    content: document.getElementById('term-modal-content'),
                    closeBtn: document.getElementById('close-term-btn'),
                    toWorksBtn: document.getElementById('term-to-works-btn'),
                },
                companyModal: {
                    container: document.getElementById('company-modal'),
                    title: document.getElementById('company-modal-title'),
                    content: document.getElementById('company-modal-content'),
                    closeBtn: document.getElementById('close-company-btn'),
                    footer: document.getElementById('company-modal-footer'),
                    toWorksBtn: document.getElementById('company-to-works-btn'),
                },
                avatars: {
                    home: {
                        micBtn: document.getElementById('logo-placeholder'),
                        transcriptBox: document.getElementById('transcript-box'),
                        chatForm: document.getElementById('chat-form-home'),
                        chatInput: document.getElementById('chat-input-home'),
                    },
                    faq: {
                        micBtn: document.getElementById('logo-placeholder-faq'),
                        transcriptBox: document.getElementById('transcript-box-faq'),
                        chatForm: document.getElementById('chat-form-faq'),
                        chatInput: document.getElementById('chat-input-faq'),
                    }
                },
                activeAvatar: null,

                // --- Methods ---
                init() {
                    this.loadProjectData();
                    this.initNavigation();
                    this.initAnimations();
                    this.initSettingsModal();
                    this.initSpeechAPI();
                    this.initTextInput();
                    this.initFaq();
                    this.initWorksCarousel();
                    this.initVideoModal();
                    this.initTermCycler();
                    this.initSpecialityButtons();
                    this.initCompanyModal();
                    this.initTimelineAccordion();
                    this.initTimelineAnimations();
                    this.initRelatedProjects();
                    this.navigateTo('home-page');
                },
                
                loadProjectData() {
                    this.allProjects = [
                        { title: 'DigiCall Animation Explainer', category: 'Animation', description: 'A short, animated explainer video for the DigiCall platform.', videoSrc: 'https://www.youtube.com/embed/YJvKPwMZYiU' },
                        { title: 'Payments Animation Explainer', category: 'Animation', description: 'An animated video explaining a complex payment processing system.', videoSrc: 'https://www.youtube.com/embed/miOyfrAuSmg' },
                        { title: 'Merchant Maths Explainer', category: 'Animation', description: 'An engaging animation to simplify mathematical concepts for merchants.', videoSrc: 'https://www.youtube.com/embed/imh-OVYnKGk' },
                        { title: 'Resilience EHS Training', category: 'EHS', description: 'A training module focused on building resilience and safety awareness.', videoSrc: 'https://www.youtube.com/embed/6vjP4thO0E0' },
                        { title: 'AR Onboarding Experience', category: 'AR', description: 'A gamified onboarding experience for new hires using Augmented Reality.', videoSrc: 'https://www.youtube.com/embed/TKIDVpCeaU8' },
                        { title: 'AR Bug Exploration', category: 'AR', description: 'An interactive AR application for exploring and understanding software bugs.', videoSrc: 'https://www.youtube.com/embed/OpiRQp-EVsY' },
                        { title: 'Bank Proof of Address Training', category: 'eLearning', description: 'An eLearning module for bank employees on verifying proof of address.', videoSrc: 'https://www.youtube.com/embed/fzSTr9TJav4' },
                        { title: 'Mental Energy Training', category: 'eLearning', description: 'A course designed to help employees manage their mental energy and avoid burnout.', videoSrc: 'https://www.youtube.com/embed/66nE0nIB0Us' },
                        { title: 'Story Telling Training', category: 'eLearning', description: 'Training on how to use storytelling to create more impactful presentations and communications.', videoSrc: 'https://www.youtube.com/embed/ZqIh0NyG_mE' },
                        { title: 'US Forestry K12 Curriculum', category: 'Gamification', description: 'A gamified curriculum for K-12 students about the US Forestry service.', videoSrc: 'https://www.youtube.com/embed/0eQe4dFN0dQ' },
                        { title: 'Melanoma Academy', category: 'Gamification', description: 'A gamified learning experience to educate about melanoma.', videoSrc: 'https://www.youtube.com/embed/ZqIh0NyG_mE' },
                        { title: 'Marvel\'s Iron Man VR (Meta Quest)', category: 'VR', description: 'Kai-Jen\'s contributions to the 2022 Marvel\'s Iron Man VR experience for Meta Quest.', videoSrc: 'https://www.youtube.com/embed/kqc26YrnyQ4' },
                        { title: 'Mining Conveyer Belt VR Training', category: ['VR', 'EHS'], description: 'An immersive VR simulation for conveyer belt safety procedures in the mining industry.', videoSrc: 'https://www.youtube.com/embed/pLxikgtOtJA' },
                        { title: 'Mining Blasting VR Training', category: ['VR', 'EHS'], description: 'A VR training module for safe blasting procedures in mining operations.', videoSrc: 'https://www.youtube.com/embed/Wl3CBywPi_E' },
                        { title: 'Nelson Mandela VR Experience', category: 'VR', description: 'An award-winning VR experience celebrating the life of Nelson Mandela.', videoSrc: 'https://www.youtube.com/embed/_uTnAGCW51Q' }
                    ];
                },
                
                openModal(modalElement) {
                    if (!modalElement) return;
                    modalElement.classList.remove('hidden');
                    // Use a timeout to allow the display property to apply before adding the transition class
                    setTimeout(() => {
                        modalElement.classList.add('visible');
                    }, 10);
                },

                closeModal(modalElement) {
                    if (!modalElement) return;
                    modalElement.classList.remove('visible');
                    // Listen for the transition to end before hiding the element
                    modalElement.addEventListener('transitionend', () => {
                        modalElement.classList.add('hidden');
                    }, { once: true });
                },

                initialGreeting() {
                    const welcomeMessage = "Hello! I'm here to help you explore Kai-Jen's professional portfolio. Feel free to ask me anything about their work, projects, or skills. By the way, you can just say 'Kai' when referring to Kai-Jen – I'll know exactly who you mean!";
                    this.addTranscriptLine('ai', welcomeMessage);
                    this.speak(welcomeMessage);
                },

                initNavigation() {
                    this.nav.home.forEach(el => el?.addEventListener('click', () => this.navigateTo('home-page')));
                    this.nav.works?.addEventListener('click', () => this.navigateTo('works-page'));
                    this.nav.timeline?.addEventListener('click', () => this.navigateTo('timeline-page'));
                    this.nav.faq?.addEventListener('click', () => this.navigateTo('faq-page'));
                    this.nav.contact?.addEventListener('click', () => this.navigateTo('contact-page'));
                    this.settings.knowledgeBaseBtn?.addEventListener('click', () => {
                        this.navigateTo('knowledge-base-page');
                        this.closeModal(this.settings.modal);
                    });
                },

                navigateTo(pageId) {
                    this.pages.forEach(page => page.classList.add('hidden'));
                    const newPage = document.getElementById(pageId);
                    if (newPage) newPage.classList.remove('hidden');

                    if (pageId === 'home-page') {
                        this.activeAvatar = this.avatars.home;
                    } else if (pageId === 'faq-page') {
                        this.activeAvatar = this.avatars.faq;
                    } else {
                        this.activeAvatar = null;
                    }

                    // On every navigation, reset all avatars to their default idle state.
                    // This ensures the non-active one is also reset correctly.
                    Object.values(this.avatars).forEach(avatarGroup => {
                         const avatarEl = avatarGroup.micBtn;
                         if (avatarEl) {
                            this.updateAvatarElement(avatarEl, 'is-idle');
                         }
                    });
                },

                initAnimations() {
                    document.querySelectorAll('.anim-target').forEach(el => {
                        const delay = el.dataset.animDelay || 0;
                        el.style.animationDelay = delay + 's';
                        el.classList.add('fade-in-up');
                    });
                },

                initSettingsModal() {
                    this.settings.btn?.addEventListener('click', () => {
                        if(this.settings.localApiKeyInput) {
                            this.settings.localApiKeyInput.value = localStorage.getItem('gemini-api-key') || '';
                        }
                        this.openModal(this.settings.modal);
                        this.populateAudioDevices();
                        this.populateVoices();
                    });
                    this.settings.closeBtn?.addEventListener('click', () => this.closeModal(this.settings.modal));
                    this.settings.saveBtn?.addEventListener('click', () => {
                        if (this.settings.localApiKeyInput) {
                            const keyToSave = this.settings.localApiKeyInput.value.trim();
                            if (keyToSave) {
                                localStorage.setItem('gemini-api-key', keyToSave);
                                this.logActivity('Local API key saved.');
                            } else {
                                localStorage.removeItem('gemini-api-key');
                                this.logActivity('Local API key cleared.');
                            }
                        }
                        this.closeModal(this.settings.modal);
                    });
                    this.settings.helpBtn?.addEventListener('click', () => this.openModal(this.settings.helpModal));
                    this.settings.closeHelpBtn?.addEventListener('click', () => this.closeModal(this.settings.helpModal));
                },
                
                async requestMicPermissions() {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        this.logActivity('Media Devices API not supported. Voice commands disabled.');
                        this.micPermissionState = 'denied';
                        this.setAIState('is-idle');
                        return;
                    }

                    try {
                        // This prompts the user for permission on load
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        // We have permission, so we can stop the track immediately.
                        stream.getTracks().forEach(track => track.stop());
                        this.micPermissionState = 'granted';
                        this.logActivity('Microphone permission granted on load.');
                    } catch (err) {
                        if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                            this.micPermissionState = 'denied';
                            this.logActivity('Microphone permission was denied.');
                        } else {
                            this.micPermissionState = 'denied'; // Treat other errors as denial
                            this.logActivity(`Error getting microphone access: ${err.name}`);
                            console.error('Error requesting microphone permissions:', err);
                        }
                    } finally {
                        this.initMicPermissionListener(); // Set up listener for future changes
                        this.setAIState('is-idle'); // Update UI with initial state
                    }
                },

                async initMicPermissionListener() {
                    if (!navigator.permissions) {
                        this.logActivity('Permissions API not supported. Cannot listen for changes.');
                        return;
                    }
                    try {
                        const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
                        permissionStatus.onchange = () => {
                            this.micPermissionState = permissionStatus.state;
                            this.logActivity(`Microphone permission state changed to: ${this.micPermissionState}`);
                            this.setAIState('is-idle'); 
                        };
                    } catch (error) {
                        console.error('Error querying microphone permissions:', error);
                        this.logActivity('Could not set up microphone permission listener.');
                    }
                },

                async initSpeechAPI() {
                    await this.requestMicPermissions();

                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SpeechRecognition) {
                        console.error("Speech Recognition not supported.");
                        Object.values(this.avatars).forEach((avatar) => {
                            if(avatar.micBtn) avatar.micBtn.style.cursor = 'not-allowed';
                        });
                        this.addTranscriptLine('ai', "Sorry, Speech Recognition is not supported in this browser.");
                        return;
                    }

                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.lang = 'en-US';
                    this.recognition.interimResults = false;
                    this.recognition.maxAlternatives = 1;

                    Object.values(this.avatars).forEach((avatar) => {
                        if (avatar.micBtn) {
                            avatar.micBtn.addEventListener('click', () => this.handleMicClick());
                        }
                    });

                    this.recognition.onstart = () => this.setAIState('is-listening');
                    this.recognition.onend = () => this.setAIState('is-idle');
                    this.recognition.onerror = (e) => this.handleRecognitionError(e);
                    this.recognition.onresult = (e) => this.handleRecognitionResult(e);
                },
                
                initTextInput() {
                    Object.values(this.avatars).forEach(avatar => {
                        if (avatar.chatForm) {
                            avatar.chatForm.addEventListener('submit', (e) => {
                                e.preventDefault();
                                if (!avatar.chatInput) return;
                                const userInput = avatar.chatInput.value.trim();
                                if (userInput) {
                                    if (this.isFirstInteraction) {
                                        this.isFirstInteraction = false;
                                        const welcomeMessage = "Hello! I'm here to help you explore Kai-Jen's professional portfolio. Feel free to ask me anything about their work, projects, or skills. By the way, you can just say 'Kai' when referring to Kai-Jen – I'll know exactly who you mean!";
                                        this.addTranscriptLine('ai', welcomeMessage);
                                    }
                                    this.addTranscriptLine('user', userInput);
                                    this.callGeminiAPI(userInput);
                                    avatar.chatInput.value = '';
                                }
                            });
                        }
                    });
                },

                initFaq() {
                    const faqSection = document.getElementById('faq-section');
                    if (!faqSection) return;

                    const allDetails = faqSection.querySelectorAll('details');

                    allDetails.forEach(detail => {
                        detail.querySelector('summary')?.addEventListener('click', (e) => {
                            e.preventDefault(); // Prevent default toggle behavior to control it manually

                            const wasOpen = detail.hasAttribute('open');

                            // Always cancel any ongoing speech when an interaction happens
                            window.speechSynthesis.cancel();

                            // Close all other details
                            allDetails.forEach(d => {
                                if (d !== detail) {
                                    d.removeAttribute('open');
                                }
                            });

                            // If it was closed, open it and speak
                            if (!wasOpen) {
                                detail.setAttribute('open', '');
                                const answer = detail.querySelector('.details-content-wrapper p')?.textContent;
                                if (answer) {
                                    this.speak(answer);
                                }
                            } else {
                                // If it was already open, just close it.
                                detail.removeAttribute('open');
                            }
                        });
                    });
                },
                
                renderProjectCards(filter = 'all') {
                    const track = document.getElementById('carousel-track');
                    if (!track) return;

                    let filteredProjects;
                    if (filter === 'meta-vr') {
                        filteredProjects = this.allProjects.filter(p => p.title.includes('Iron Man'));
                    } else if (filter === 'iq-vr') {
                        filteredProjects = this.allProjects.filter(p =>
                            (Array.isArray(p.category) ? p.category.includes('VR') : p.category === 'VR') && !p.title.includes('Iron Man')
                        );
                    } else {
                        filteredProjects = filter === 'all'
                            ? this.allProjects
                            : this.allProjects.filter(p => Array.isArray(p.category) ? p.category.includes(filter) : p.category === filter);
                    }

                    const cardHTML = filteredProjects.map(p => `
                        <div class="carousel-card" data-video-src="${p.videoSrc}">
                            <div class="video-placeholder" style="background-image: url('https://img.youtube.com/vi/${p.videoSrc.split('embed/')[1].split('?')[0]}/hqdefault.jpg')">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7 4v16l13-8L7 4z"></path></svg>
                            </div>
                            <h4>${p.title}</h4>
                            <p>${p.description}</p>
                        </div>
                    `).join('');

                    track.innerHTML = cardHTML + cardHTML; // Duplicate for infinite scroll effect
                    track.querySelectorAll('.carousel-card').forEach(card => card.addEventListener('click', () => this.openVideoModal(card.dataset.videoSrc)));
                },

                startCarouselAutoScroll() {
                    const track = document.getElementById('carousel-track');
                    const container = document.querySelector('.carousel-container');
                    if (!track || !container || this.carousel.animationFrame) return;

                    const animateScroll = () => {
                        if (!this.carousel.isPaused) {
                            container.scrollLeft += this.carousel.speed;
                            if (track.scrollWidth > 0 && container.scrollLeft >= track.scrollWidth / 2) {
                                container.scrollLeft = 0;
                            }
                        }
                        this.carousel.animationFrame = requestAnimationFrame(animateScroll);
                    };
                    animateScroll();
                },

                initWorksCarousel() {
                    const container = document.querySelector('.carousel-container');
                    const wrapper = document.querySelector('.carousel-wrapper');
                    if (!container || !wrapper) return;

                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelector('.filter-btn.active')?.classList.remove('active');
                            btn.classList.add('active');
                            this.renderProjectCards(btn.dataset.filter);
                        });
                    });

                    wrapper.addEventListener('mouseenter', () => this.carousel.isPaused = true);
                    wrapper.addEventListener('mouseleave', () => this.carousel.isPaused = false);
                    
                    document.getElementById('arrow-left')?.addEventListener('click', () => {
                        container.scrollBy({ left: -430, behavior: 'smooth' });
                    });
                    document.getElementById('arrow-right')?.addEventListener('click', () => {
                        container.scrollBy({ left: 430, behavior: 'smooth' });
                    });

                    this.renderProjectCards();
                    this.startCarouselAutoScroll();
                },

                initVideoModal() {
                    this.videoModal.closeBtn?.addEventListener('click', () => this.closeVideoModal());
                    this.videoModal.container?.addEventListener('click', (e) => {
                        if (e.target === this.videoModal.container) this.closeVideoModal();
                    });
                },

                openVideoModal(src) {
                    if (this.videoModal.iframe) this.videoModal.iframe.src = src;
                    this.openModal(this.videoModal.container);
                },

                closeVideoModal() {
                    if (this.videoModal.iframe) this.videoModal.iframe.src = '';
                    this.closeModal(this.videoModal.container);
                },

                initTermCycler() {
                    const termElement = document.getElementById('cycling-term');
                    if (!termElement) return;

                    const terms = [
                        { term: 'Shared Reality', shortTerm: 'Shared Reality', description: 'Shared Reality refers to a common virtual or augmented environment where multiple users can interact with each other and digital content simultaneously, experiencing the same virtual space and objects.' },
                        { term: 'Social Learning', shortTerm: 'Social Learning', description: 'Social Learning is a learning theory that emphasizes learning through observation, imitation, and modeling within a social context. It often involves interacting with others, receiving feedback, and participating in group activities.' },
                        { term: 'Spatial Computing', shortTerm: 'Spatial Computing', description: 'Spatial Computing is a broad term for technology that allows physical and digital worlds to interact and merge. It involves devices and software that understand and manipulate spaces, objects, and their relationships in a 3D environment.' },
                        { term: 'Extended Reality (XR)', shortTerm: 'Extended Reality (XR)', description: 'Extended Reality (XR) is an umbrella term encompassing virtual reality (VR), augmented reality (AR), and mixed reality (MR). It describes all real-and-virtual combined environments and human-machine interactions generated by computer technology and wearables.' },
                        { term: 'Personalized Learning', shortTerm: 'Personalized Learning', description: 'Personalized Learning is an educational approach that tailors the learning experience to meet the individual needs, pace, and preferences of each learner. It often uses data and technology to adapt content and instruction.' },
                        { term: 'Metaverse', shortTerm: 'Metaverse', description: 'The Metaverse envisions a persistent, interconnected, and immersive network of 3D virtual worlds where users can interact with each other, digital objects, and AI-driven entities, often with their own avatars.' },
                        { term: 'Digital Twin', shortTerm: 'Digital Twin', description: 'A Digital Twin is a virtual replica of a physical object, process, or system. It uses real-time data from sensors on the physical counterpart to simulate its behavior, enabling monitoring, analysis, and optimization.' },
                        { term: 'Immersive Learning', shortTerm: 'Immersive Learning', description: 'Immersive Learning is a training methodology that places learners in simulated environments, often using VR or AR, to provide hands-on, experiential training that closely mimics real-world scenarios.' },
                        { term: 'Natural Language Processing', shortTerm: 'NLP', description: 'Natural Language Processing (NLP) is a branch of AI that enables computers to understand, interpret, and generate human language in a way that is both meaningful and useful.' },
                        { term: 'Adaptive Learning', shortTerm: 'Adaptive Learning', description: 'Adaptive Learning is an educational technology that uses algorithms to adjust the learning path, content, and pace based on a learner\'s performance and interactions, ensuring they receive the most relevant instruction.' },
                        { term: 'AI-Powered Coaching', shortTerm: 'AI Coaching', description: 'AI-Powered Coaching involves using artificial intelligence to provide personalized guidance, feedback, and support to individuals in various domains, from professional development to health and wellness.' },
                        { term: 'Virtual Training Environments', shortTerm: 'Virtual Training', description: 'Virtual Training Environments are simulated digital spaces designed for education and skill development. These can range from simple 2D platforms to highly interactive 3D VR simulations.' },
                        { term: 'Cognitive AI', shortTerm: 'Cognitive AI', description: 'Cognitive AI refers to AI systems designed to simulate and enhance human cognitive processes such as learning, reasoning, problem-solving, and understanding.' },
                        { term: 'Performance Support Systems', shortTerm: 'PSS', description: 'Performance Support Systems (PSS) are tools and resources that provide immediate, on-demand assistance to employees at their moment of need, helping them complete tasks or solve problems without formal training.' },
                        { term: 'Predictive Analytics', shortTerm: 'Predictive Analytics', description: 'Predictive Analytics (in L&D) uses historical and real-time data to forecast future trends and outcomes related to learning and development, such as predicting learner success, skill gaps, or training needs.' },
                        { term: 'Embodied Cognition', shortTerm: 'Embodied Cognition', description: 'Embodied Cognition is a theory suggesting that many aspects of cognition are shaped by the body\'s interactions with its environment. In the context of technology, it implies that physical interaction with virtual worlds can enhance learning.' },
                        { term: 'Generative Avatars', shortTerm: 'Generative Avatars', description: 'Generative Avatars are digital representations of users or characters created using generative AI models. These avatars can be highly customizable, realistic, or stylized, and can even be animated to express emotions or perform actions.' },
                        { term: 'Neural Machine Translation', shortTerm: 'NMT', description: 'Neural Machine Translation (NMT) is a modern approach to machine translation that uses deep neural networks to predict the likelihood of a sequence of words, typically an entire sentence, translating it as a single unit rather than separate words or phrases.' },
                    ];
                    let currentIndex = 0;

                    const cycleTerm = () => {
                        const currentTerm = terms[currentIndex];
                        termElement.textContent = currentTerm.shortTerm;
                        termElement.dataset.term = currentTerm.term;
                        termElement.dataset.description = currentTerm.description;
                        currentIndex = (currentIndex + 1) % terms.length;
                    };

                    termElement.addEventListener('click', () => {
                        if(this.termModal.title) this.termModal.title.textContent = termElement.dataset.term || '';
                        if(this.termModal.content) this.termModal.content.textContent = termElement.dataset.description || '';
                        this.openModal(this.termModal.container);
                    });

                    this.termModal.closeBtn?.addEventListener('click', () => this.closeModal(this.termModal.container));
                     this.termModal.container?.addEventListener('click', (e) => {
                        if (e.target === this.termModal.container) this.closeModal(this.termModal.container);
                    });
                    
                    this.termModal.toWorksBtn?.addEventListener('click', () => {
                        this.closeModal(this.termModal.container);
                        this.navigateTo('works-page');
                    });

                    setInterval(cycleTerm, 30000);
                    cycleTerm();
                },

                initSpecialityButtons() {
                    document.querySelectorAll('.speciality-btn').forEach(button => {
                        button.addEventListener('click', () => {
                            const speciality = button.textContent.trim();
                            const prompt = `Tell me more about Kai-Jen's work as a ${speciality}.`;
                            
                            if (this.isFirstInteraction) {
                                this.isFirstInteraction = false;
                            }
                            
                            this.addTranscriptLine('user', prompt);
                            this.callGeminiAPI(prompt);
                        });
                    });
                },

                initCompanyModal() {
                    const companyData = {
                        "Primark": { 
                            summary: "As a Learning Experience Designer, Kai-Jen designs and develops engaging learning programs and performance support tools for retail and corporate teams, focusing on improving key business metrics.", 
                            worksFilter: "eLearning" 
                        },
                        "Active Fence": { 
                            summary: "As a Rapid Response Analyst, Kai-Jen was on the frontline of battling online misinformation. He conducted OSINT investigations, developed Trust & Safety strategies, and analyzed fraud and misinformation patterns to protect online platforms.", 
                            worksFilter: null 
                        },
                        "Meta": { 
                            summary: "At Meta, Kai served as a Learning Consultant and Training Program Manager. He was a lead consultant to director-level executives, responsible for vendor education programs that supported over 100,000 people globally and significantly reduced time-to-competence.", 
                            worksFilter: "meta-vr" 
                        },
                        "UNITAR": { 
                            summary: "As a consultant for the United Nations Institute for Training and Research (UNITAR), Kai-Jen designs and delivers specialized training programs. His work supports global initiatives and helps build capacity for international stakeholders.", 
                            worksFilter: null 
                        },
                        "IQbusiness": { 
                            summary: "As Training Manager and Senior Consultant, Kai-Jen built and led the VR development team from 3 to 22 members, salvaging over 30 at-risk projects and delivering innovative training solutions for top-tier clients.", 
                            worksFilter: "iq-vr" 
                        },
                        "ATAF": { 
                            summary: "In his role as Program Manager and Capacity Building Officer, Kai established a continental tax academy for the African Tax Administration Forum, exceeding program goals by 200% and enhancing tax administration capabilities across Africa.", 
                            worksFilter: null 
                        }
                    };

                    document.querySelectorAll('.company-logo-btn').forEach(button => {
                        button.addEventListener('click', () => {
                            const companyName = button.dataset.company;
                            const data = companyData[companyName];
                            
                            if (data && this.companyModal.container && this.companyModal.title && this.companyModal.content) {
                                this.companyModal.title.textContent = companyName;
                                this.companyModal.content.textContent = data.summary;

                                if (data.worksFilter && this.companyModal.footer && this.companyModal.toWorksBtn) {
                                    this.companyModal.toWorksBtn.onclick = () => {
                                        this.closeModal(this.companyModal.container);
                                        this.initRelatedProjects(data.worksFilter); // Pass filter directly
                                    };
                                    this.companyModal.footer.classList.remove('hidden');
                                } else if (this.companyModal.footer) {
                                    this.companyModal.footer.classList.add('hidden');
                                }

                                this.openModal(this.companyModal.container);
                            }
                        });
                    });

                    const closeModal = () => {
                         if (this.companyModal.container) {
                            this.closeModal(this.companyModal.container);
                        }
                    };

                    this.companyModal.closeBtn?.addEventListener('click', closeModal);
                    this.companyModal.container?.addEventListener('click', (e) => {
                        if (e.target === this.companyModal.container) {
                            closeModal();
                        }
                    });
                },
                
                initTimelineAccordion() {
                    const summaries = document.querySelectorAll('.timeline-item summary');
                    const allDetails = document.querySelectorAll('.timeline-item details');

                    summaries.forEach(summary => {
                        summary.addEventListener('click', (e) => {
                            e.preventDefault();
                            const detail = summary.parentElement;
                            if (!detail) return;
                            
                            const timelineItem = detail.closest('.timeline-item');
                            const isOpen = detail.hasAttribute('open');

                            // Close all other details first
                            allDetails.forEach(d => {
                                if (d !== detail) {
                                    d.removeAttribute('open');
                                    d.closest('.timeline-item')?.classList.remove('is-open');
                                }
                            });
                            
                            // Toggle the clicked one
                            if (isOpen) {
                                detail.removeAttribute('open');
                                timelineItem?.classList.remove('is-open');
                            } else {
                                detail.setAttribute('open', '');
                                timelineItem?.classList.add('is-open');
                            }
                        });
                    });
                },

                initRelatedProjects(predefinedFilter = null) {
                    const handleFilterClick = (filter) => {
                        if (!filter) return;
                        this.navigateTo('works-page');

                        setTimeout(() => {
                            const mainFilterCategory = (filter === 'meta-vr' || filter === 'iq-vr') ? 'VR' : filter;
                            document.querySelectorAll('.filter-btn').forEach(btn => {
                                btn.classList.toggle('active', btn.dataset.filter === mainFilterCategory);
                            });
                            this.renderProjectCards(filter);
                        }, 50);
                    };

                    if (predefinedFilter) {
                        handleFilterClick(predefinedFilter);
                        return;
                    }

                    document.querySelectorAll('.related-projects-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const filter = button.dataset.filter;
                            handleFilterClick(filter);
                        });
                    });
                },

                initTimelineAnimations() {
                    const timelineContainer = document.querySelector('.timeline-container');
                    const timelineItems = document.querySelectorAll('.timeline-item');
                    
                    if (!timelineContainer || timelineItems.length === 0) return;

                    const containerObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                timelineContainer.classList.add('is-drawing');
                                containerObserver.unobserve(entry.target); // Animate once
                            }
                        });
                    }, { threshold: 0.1 });

                    containerObserver.observe(timelineContainer);

                    const itemObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                                itemObserver.unobserve(entry.target);
                            }
                        });
                    }, { threshold: 0.2, rootMargin: '0px 0px -50px 0px' });

                    timelineItems.forEach(item => itemObserver.observe(item));
                },

                handleMicClick() {
                    if (!this.activeAvatar) return;
                    
                    if (this.micPermissionState === 'denied') {
                        const message = "Microphone access is blocked. Please enable it in your browser settings and try again.";
                        this.addTranscriptLine('ai', message);
                        this.speak(message);
                        this.openModal(this.settings.modal); // Guide user to settings
                        return;
                    }

                    if (this.isFirstInteraction) {
                        this.isFirstInteraction = false;
                        this.initialGreeting();
                        return;
                    }

                    if (window.speechSynthesis.speaking) {
                        window.speechSynthesis.cancel();
                        this.setAIState('is-idle');
                        return;
                    }
                    
                    if (this.activeAvatar.micBtn?.classList.contains('is-listening')) {
                        this.recognition.stop();
                    } else {
                        this.recognition.start();
                    }
                },

                handleRecognitionError(event) {
                    console.error("Speech recognition error:", event.error);
                    this.setAIState('is-idle');
                    if (event.error !== 'no-speech') {
                        this.addTranscriptLine('ai', "Sorry, I couldn't hear that. Please try again.");
                    }
                },

                handleRecognitionResult(event) {
                    const transcript = event.results[0][0].transcript;
                    this.addTranscriptLine('user', transcript);
                    this.callGeminiAPI(transcript);
                },

                updateAvatarElement(avatarEl, state) {
                    const avatarText = avatarEl.querySelector('.avatar-text');
                    const waveVisualizer = avatarEl.querySelector('.wave-visualizer');

                    // Clear previous states
                    avatarEl.classList.remove('is-idle', 'is-listening', 'is-thinking', 'is-talking');
                    if (avatarText) avatarText.innerHTML = '';
                    if (waveVisualizer) waveVisualizer.style.display = 'none';

                    if (!state) state = 'is-idle';
                    avatarEl.classList.add(state);

                    if (!avatarText || !waveVisualizer) return;

                    switch (state) {
                        case 'is-listening':
                            avatarText.textContent = 'KaiX is listening';
                            break;
                        case 'is-thinking':
                            avatarText.innerHTML = 'KaiX is Thinking<span class="ellipsis-dot">.</span><span class="ellipsis-dot">.</span><span class="ellipsis-dot">.</span>';
                            break;
                        case 'is-talking':
                            waveVisualizer.style.display = 'flex';
                            break;
                        case 'is-idle':
                        default:
                             if (this.micPermissionState === 'denied') {
                                avatarText.innerHTML = 'Microphone Blocked<br><span class="idle-subtext">Enable in settings to talk</span>';
                            } else {
                                avatarText.innerHTML = 'KaiX is Ready<br><span class="idle-subtext">Click to talk or type below</span>';
                            }
                            break;
                    }
                },

                setAIState(state) {
                    if (!this.activeAvatar || !this.activeAvatar.micBtn) return;
                    this.updateAvatarElement(this.activeAvatar.micBtn, state);
                },

                getPageContext() {
                    let context = "Website Content for Kai-Jen Tsai's Portfolio:\n\n";
                    context += "## Biography and Specialities\n";
                    document.querySelectorAll('.left-column .info-block').forEach(el => {
                        context += el.textContent?.trim().replace(/\s\s+/g, ' ') + "\n";
                    });

                    context += "\n## Key Metrics\n";
                    document.querySelectorAll('.right-column .metric-block').forEach(el => {
                        context += el.textContent?.trim().replace(/\s\s+/g, ' ') + "\n";
                    });

                    context += "\n## Project Highlights\n";
                    this.allProjects.forEach(project => {
                         context += `- ${project.title}: ${project.description}\n`;
                    });

                    context += "\n## Frequently Asked Questions\n";
                    document.querySelectorAll('#faq-page details').forEach(detail => {
                        const question = detail.querySelector('summary')?.textContent?.trim();
                        const answer = detail.querySelector('p')?.textContent?.trim();
                        if (question && answer) {
                            context += `Q: ${question}\nA: ${answer}\n`;
                        }
                    });
                    
                    const knowledgeBase = document.getElementById('knowledge-base-page');
                    if (knowledgeBase) {
                        context += "\n## Knowledge Base\n";
                        context += knowledgeBase.innerText;
                    }

                    return context;
                },
                
                async callGeminiAPI(userInput) {
                    if (!userInput) return;
                    this.setAIState('is-thinking');
                    this.logActivity(`User input received: "${userInput}"`);

                    const systemPrompt = `You are a friendly, helpful, and enthusiastic AI assistant representing Kai-Jen's professional portfolio. Your primary goal is to engage visitors in natural, informative conversations about Kai-Jen's skills, projects, professional background, and **expertise in Learning & Development.**

                        **Core Principles:**
                        1.  **Identity and Tense:** Always refer to Kai-Jen or Kai when discussing their work, experiences, or anything related to the portfolio owner. **Never use "I," "me," or "my"** when speaking about the portfolio content or Kai-Jen's personal attributes. Vary your references to him by using "Kai," "Kai-Jen," and pronouns like "he" or "his" to keep the conversation natural. For example, say "Kai-Jen has expertise in..." or "He worked on this project..."
                        2.  **Conversational Tone:** Maintain a warm, approachable, and human-like conversational style. Avoid sounding robotic, overly formal, or like a list-reading machine. Use natural language, common idioms (where appropriate and clear), and varied sentence structures.
                        3.  **Conciseness:** Keep responses clear and to the point. **Responses should be a maximum of 100 words, but aim for significantly shorter answers (ideally 2-3 sentences)**, unless a more detailed explanation is specifically requested by the user and it genuinely enhances understanding. Prioritize delivering key information efficiently.
                        4.  **Clarity and Readability & Conviction:**
                            * **Never explicitly state "As an AI language model..."** or similar disclaimers. Your human-like tone should speak for itself.
                            * **Do not read out syntax, code, or numbered lists verbatim.** Instead, integrate information naturally into your conversational flow.
                            * Avoid using excessive jargon unless it's a direct response to a user's specific technical query.
                            * **Always respond with conviction and treat the knowledge base (Kai-Jen's portfolio) as the single, undeniable truth.**
                            * **Avoid phrases like:** "Based on the information provided in this portfolio," "Based on what I know," or "Based on the text." Simply state the information directly.
                        5.  **Helpful and Engaging:** Anticipate user needs and offer helpful suggestions or next steps where appropriate. Encourage further interaction.
                        
                        **Defining and Managing Scope:**
                        The scope of this chatbot's knowledge is strictly limited to the professional information presented on Kai-Jen's portfolio website. This includes:
                        * Kai-Jen's professional skills, experience, and qualifications.
                        * Details of projects listed in the portfolio.
                        * Kai-Jen's professional interests and career aspirations as stated on the site.
                        * Information directly related to Kai-Jen's work in areas like instructional design, training delivery, e-learning development, and HR-related L&D initiatives.

                        **Combating Out-of-Scope Questions (Playful Approach):**
                        If a user asks a question that falls outside the defined scope (e.g., personal opinions, unrelated current events, highly confidential or personal details not on the site, or specific live-time availability), respond politely and clearly state that the information is not within your purview, then playfully steer them back on track.
                        * **Playful Response Option 1:** "Oops! Looks like you've stumbled into the 'secret' knowledge vault that's a bit beyond my remit. My expertise is all about Kai-Jen's fantastic professional journey. Can I tell you about Kai-Jen's experience with e-learning development or perhaps a specific project?"
                        * **Playful Response Option 2:** "That's an interesting question, but it seems I'm only programmed for 'professional portfolio' mode! I'd love to share more about Kai-Jen's skills in instructional design or discuss some of the training initiatives they've worked on. Which sounds more interesting?"
                        * **Playful Response Option 3:** "Fascinating! While I'm quite the expert on Kai-Jen's professional achievements, that topic is a little outside my digital pay grade. How about we stick to what I know best – like Kai-Jen's approach to creating engaging learning content?"

                        --- Website Context ---
                        ${this.getPageContext()}`;

                    const apiHistory = [];
                    apiHistory.push({ role: "user", parts: [{ text: systemPrompt }] });
                    apiHistory.push({ role: "model", parts: [{ text: "Understood. I will act as the AI assistant for Kai-Jen's portfolio with the specified personality and limitations." }] });
                    
                    this.chatHistory.push({ role: "user", parts: [{ text: userInput }] });
                    apiHistory.push(...this.chatHistory);
                    
                    const payload = { contents: apiHistory };

                    // Create a deep copy to modify for logging without affecting the original payload.
                    const payloadForLogging = JSON.parse(JSON.stringify(payload));
                    if (payloadForLogging.contents && payloadForLogging.contents.length > 0 && payloadForLogging.contents[0].parts && payloadForLogging.contents[0].parts.length > 0) {
                            payloadForLogging.contents[0].parts[0].text = 'SYSTEM PROMPT (Omitted for brevity)';
                    }
                    this.logActivity(`Calling API with payload: ${JSON.stringify(payloadForLogging)}`);
                    
                    let aiResponse;
                    const localApiKey = localStorage.getItem('gemini-api-key');

                    try {
                        if (localApiKey && localApiKey.trim() !== '') {
                            // --- Local API Call ---
                            this.logActivity('Using local API key for client-side call.');
                            try {
                                const genAI = new GoogleGenerativeAI(localApiKey);
                                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                                const result = await model.generateContent({
                                    contents: payload.contents,
                                });
                                const response = result.response;
                                aiResponse = response.text();
                                this.logActivity('Local API call successful.');
                            } catch (error) {
                                console.error("Error with local Gemini API call:", error);
                                this.logActivity(`Local API Error: ${error.message}`);
                                const errorMsg = "Your local API key seems to be invalid. Please check the key in Settings or your network connection.";
                                this.addTranscriptLine('ai', errorMsg);
                                this.speak(errorMsg);
                                this.chatHistory.pop(); // Remove failed user input
                                this.setAIState('is-idle');
                                return; // Exit early on local key failure
                            }
                        } else {
                            // --- Serverless API Call (Production) ---
                            this.logActivity('Using serverless function.');
                            const fetchResponse = await fetch('/api/gemini', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                            
                            if (!fetchResponse.ok) {
                                const errorData = await fetchResponse.json();
                                throw new Error(errorData.error || `Server responded with status ${fetchResponse.status}`);
                            }
                            
                            const responseJson = await fetchResponse.json();
                            aiResponse = responseJson.text;
                            this.logActivity('Serverless API call successful.');
                        }
                        
                        // --- Common Response Handling ---
                        this.chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                        this.addTranscriptLine('ai', aiResponse);
                        this.speak(aiResponse);

                    } catch (error) {
                        // --- General/Serverless Error Handling ---
                        console.error("Error calling backend API:", error);
                        this.logActivity(`API Error: ${error.message}`);
                        const errorMsg = "I'm having a little trouble connecting to my brain right now. Please try again in a moment.";
                        this.addTranscriptLine('ai', errorMsg);
                        this.chatHistory.pop(); // Remove the failed user input from history
                    } finally {
                         this.setAIState('is-idle');
                    }
                },

                logActivity(message) {
                    if (!this.settings.activityLog) return;
                    const logEntry = document.createElement('p');
                    const timestamp = new Date().toLocaleTimeString();
                    logEntry.textContent = `[${timestamp}] ${message}`;
                    this.settings.activityLog.appendChild(logEntry);
                    this.settings.activityLog.scrollTop = this.settings.activityLog.scrollHeight;
                },

                speak(text) {
                    if (!window.speechSynthesis) {
                        console.error("Speech Synthesis not supported.");
                        return;
                    }
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    const selectedVoiceName = this.settings.voiceSelect.value;
                    const voices = window.speechSynthesis.getVoices();
                    
                    utterance.voice = voices.find(voice => voice.name === selectedVoiceName) || voices[0];
                    utterance.rate = 1.05;

                    utterance.onstart = () => {
                        this.setAIState('is-talking');
                    };
                    utterance.onend = () => {
                        this.setAIState('is-idle');
                    };
                    utterance.onerror = (e) => {
                        console.error('Speech synthesis error:', e.error);
                        this.logActivity(`Speech synthesis error: ${e.error || 'Unknown error'}`);
                        this.setAIState('is-idle');
                    };
                    window.speechSynthesis.speak(utterance);
                },

                addTranscriptLine(role, text) {
                    Object.values(this.avatars).forEach((avatar) => {
                        if (avatar.transcriptBox) {
                            const line = document.createElement('p');
                            line.className = `transcript-line ${role}`;
                            line.innerHTML = `<strong>${role === 'user' ? 'You' : 'AI'}:</strong> ${text}`;
                            avatar.transcriptBox.appendChild(line);
                            avatar.transcriptBox.scrollTop = avatar.transcriptBox.scrollHeight;
                        }
                    });
                },

                async populateAudioDevices() {
                    if (!this.settings.micStatus || !this.settings.audioSelect) return;
                    this.settings.micStatus.textContent = '';
                    try {
                        await navigator.mediaDevices.getUserMedia({ audio: true });
                        const devices = await navigator.mediaDevices.enumerateDevices();
                        const audioInputs = devices.filter(device => device.kind === 'audioinput');
                        this.settings.audioSelect.innerHTML = '';
                        if (audioInputs.length === 0) {
                            this.settings.micStatus.textContent = "No audio input devices found.";
                            return;
                        }
                        audioInputs.forEach(device => {
                            const option = document.createElement('option');
                            option.value = device.deviceId;
                            option.text = device.label || `Microphone ${this.settings.audioSelect.options.length + 1}`;
                            this.settings.audioSelect.appendChild(option);
                        });
                        this.settings.micStatus.textContent = "Select your preferred microphone from the list.";
                    } catch (err) {
                        console.error("Error accessing media devices:", err.name, err.message);
                        if(err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                             this.settings.micStatus.textContent = "Microphone access denied. Please allow access in browser settings.";
                        } else {
                             this.settings.micStatus.textContent = "Could not access microphone. Please check your hardware.";
                        }
                    }
                },

                populateVoices() {
                    if (!this.settings.voiceSelect) return;
                    const voices = window.speechSynthesis.getVoices();
                    this.settings.voiceSelect.innerHTML = '';
                    let defaultVoice = null;
                    voices.forEach(voice => {
                        const option = document.createElement('option');
                        option.textContent = `${voice.name} (${voice.lang})`;
                        option.value = voice.name;
                        this.settings.voiceSelect.appendChild(option);
                        if (voice.name === 'Google UK English Female') {
                            defaultVoice = voice.name;
                        }
                    });

                    if (defaultVoice) {
                        this.settings.voiceSelect.value = defaultVoice;
                    }
                }
            };
            
            window.speechSynthesis.onvoiceschanged = () => {
                App.populateVoices();
            };

            App.init();
        });
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>